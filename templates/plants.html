{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <div>
        <h2 style="color: #2e7d32; margin-bottom: 5px;">
            <i class="fas fa-seedling" style="margin-right: 10px;"></i>
            Plant Inventory
        </h2>
        <p style="color: #6c757d;">Manage your plant collection and pricing</p>
    </div>
    {% set user_role = session.get('user') and users.get(session.user, {}).get('role', 'user') %}
    {% if user_role in ['admin', 'manager'] %}
    <a href="/add_plant" class="btn">
        <i class="fas fa-plus"></i> Add New Plant
    </a>
    {% endif %}
</div>

{% if plants %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th><i class="fas fa-hashtag" style="margin-right: 8px;"></i>ID</th>
                <th><i class="fas fa-leaf" style="margin-right: 8px;"></i>Plant Name</th>
                <th><i class="fas fa-coins" style="margin-right: 8px;"></i>Price</th>
                {% if user_role in ['admin', 'manager'] %}
                <th><i class="fas fa-cogs" style="margin-right: 8px;"></i>Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for plant in plants %}
            <tr>
                <td style="font-weight: 600; color: #2e7d32;">#{{ plant.id }}</td>
                <td>
                    <div style="display: flex; align-items: center;">
                        <div style="background: #e8f5e8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-seedling" style="color: #2e7d32;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: #333;">{{ plant.name }}</div>
                            <div style="font-size: 0.9rem; color: #6c757d;">Available in stock</div>
                        </div>
                    </div>
                </td>
                <td>
                    <span style="background: #e8f5e8; color: #2e7d32; padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                        {{ plant.price|ksh }}
                    </span>
                </td>
                {% if user_role in ['admin', 'manager'] %}
                <td>
                    <div style="display: flex; gap: 10px;">
                        <a href="/edit_plant/{{ plant.id }}" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px; text-decoration: none;">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        {% if user_role == 'admin' %}
                        <a href="/delete_plant/{{ plant.id }}" class="btn btn-danger" style="padding: 8px 16px; font-size: 14px; text-decoration: none;" onclick="return confirm('Are you sure you want to delete this plant?')">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                        {% endif %}
                    </div>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; margin-top: 30px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h4 style="color: #495057; margin-bottom: 5px;">
                <i class="fas fa-chart-bar" style="margin-right: 8px;"></i>
                Inventory Summary
            </h4>
            <p style="color: #6c757d; margin: 0;">Total plants in inventory: <strong>{{ plants|length }}</strong></p>
        </div>
        <div style="text-align: right;">
            <div style="color: #2e7d32; font-size: 1.5rem; font-weight: 600;">
                KSh {{ "{:,.2f}".format(plants|sum(attribute='price') * ksh_rate()) }}
            </div>
            <div style="color: #6c757d; font-size: 0.9rem;">Total inventory value</div>
        </div>
    </div>
</div>

{% else %}
<div class="empty-state">
    <i class="fas fa-seedling"></i>
    <h3 style="color: #6c757d; margin-bottom: 15px;">No Plants in Inventory</h3>
    <p style="margin-bottom: 30px;">Start building your plant collection by adding your first plant.</p>
    {% if user_role in ['admin', 'manager'] %}
    <a href="/add_plant" class="btn">
        <i class="fas fa-plus"></i> Add Your First Plant
    </a>
    {% endif %}
</div>
{% endif %}

<div style="margin-top: 30px; text-align: center;">
    <a href="/dashboard" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>
{% endblock %}