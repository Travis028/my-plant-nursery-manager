{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <div>
        <h2 style="color: #2e7d32; margin-bottom: 5px;">
            <i class="fas fa-chart-line" style="margin-right: 10px;"></i>
            Sales Analytics
        </h2>
        <p style="color: #6c757d;">Track your business performance and transactions</p>
    </div>
    <a href="/record_sale" class="btn">
        <i class="fas fa-cash-register"></i> Record New Sale
    </a>
</div>

{% if sales %}
<!-- Sales Summary Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div style="background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); padding: 25px; border-radius: 15px; text-align: center;">
        <div style="color: #2e7d32; font-size: 2rem; font-weight: 600; margin-bottom: 5px;">{{ sales|length }}</div>
        <div style="color: #4a5568; font-weight: 500;">Total Sales</div>
    </div>
    <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%); padding: 25px; border-radius: 15px; text-align: center;">
        <div style="color: #f57c00; font-size: 2rem; font-weight: 600; margin-bottom: 5px;">
            {% set total_revenue_usd = sales|sum(attribute='plant.price') %}
            {% set ksh_rate = ksh_rate() %}
            KSh {{ "{:,.2f}".format(total_revenue_usd * ksh_rate) }}
        </div>
        <div style="color: #4a5568; font-weight: 500;">Total Revenue</div>
    </div>
    <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 25px; border-radius: 15px; text-align: center;">
        <div style="color: #1976d2; font-size: 2rem; font-weight: 600; margin-bottom: 5px;">
            {% set avg_sale_usd = (total_revenue_usd / sales|length) if sales|length > 0 else 0 %}
            KSh {{ "{:,.2f}".format(avg_sale_usd * ksh_rate) }}
        </div>
        <div style="color: #4a5568; font-weight: 500;">Average Sale</div>
    </div>
</div>

<!-- Sales Table -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th><i class="fas fa-hashtag" style="margin-right: 8px;"></i>Sale ID</th>
                <th><i class="fas fa-seedling" style="margin-right: 8px;"></i>Plant</th>
                <th><i class="fas fa-user" style="margin-right: 8px;"></i>Customer</th>
                <th><i class="fas fa-user-tie" style="margin-right: 8px;"></i>Employee</th>
                <th><i class="fas fa-coins" style="margin-right: 8px;"></i>Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
            <tr>
                <td style="font-weight: 600; color: #2e7d32;">#{{ sale.id }}</td>
                <td>
                    <div style="display: flex; align-items: center;">
                        <div style="background: #e8f5e8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-seedling" style="color: #2e7d32;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: #333;">{{ sale.plant.name }}</div>
                            <div style="font-size: 0.9rem; color: #6c757d;">Plant ID: #{{ sale.plant.id }}</div>
                        </div>
                    </div>
                </td>
                <td>
                    <div style="display: flex; align-items: center;">
                        <div style="background: #e3f2fd; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-user" style="color: #1976d2; font-size: 0.9rem;"></i>
                        </div>
                        <span style="font-weight: 500;">{{ sale.customer.name }}</span>
                    </div>
                </td>
                <td>
                    <div style="display: flex; align-items: center;">
                        <div style="background: #fce4ec; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <i class="fas fa-user-tie" style="color: #c2185b; font-size: 0.9rem;"></i>
                        </div>
                        <span style="font-weight: 500;">{{ sale.employee.name }}</span>
                    </div>
                </td>
                <td>
                    <span style="background: #e8f5e8; color: #2e7d32; padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                        {{ sale.plant.price|ksh }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="empty-state">
    <i class="fas fa-chart-line"></i>
    <h3 style="color: #6c757d; margin-bottom: 15px;">No Sales Recorded Yet</h3>
    <p style="margin-bottom: 30px;">Start tracking your business performance by recording your first sale.</p>
    <a href="/record_sale" class="btn">
        <i class="fas fa-cash-register"></i> Record Your First Sale
    </a>
</div>
{% endif %}

<div style="margin-top: 30px; text-align: center;">
    <a href="/" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>
{% endblock %}